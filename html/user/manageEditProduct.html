<!doctype html>
<html lang="en">

<head>
    <title>Cập nhật thông tin sản phẩm</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v6.0.0-beta3/css/all.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="/css/manageEditProduct.css" />
</head>

<body>
    <main class="container-them-sanpham ">
        <div class="container-col-1">
            <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);"
                aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="manageProducts.html"> <i
                                class="bi bi-chevron-compact-left"></i> Quay lại danh sách sản phẩm</a></li>
                </ol>
            </nav>
            
            <h3 class="title-manage-products">Thông tin sản phẩm</h3>

            <div class="container-info-sanpham">
                <form class="form-info-sanpham row">
                    <div class="info col-md-12">
                        <div class="lbl-info">
                            <label for="ten-sanpham" class="form-label">Tên sản phẩm <span style="color: red;">*</span>
                            </label>
                        </div>
                        <input type="text" class="form-control" id="ten-sanpham" placeholder="Nhập tên sản phẩm" />
                    </div>
                    <div class="info col-md-6">
                        <div class="lbl-info">
                            <label for="id-sanpham" class="form-label">Mã sản phẩm <span
                                    style="color: red;">*</span></label>
                        </div>
                        <input type="text" class="form-control" id="id-sanpham" />
                    </div>
                    <div class="info col-md-6">
                        <div class="lbl-info">
                            <label for="soluong-sanpham" class="form-label">Số lượng </label>
                        </div>
                        <input type="number" class="form-control" id="soluong-sanpham" value="1" />
                    </div>
                    <div class="info col-md-6">
                        <div class="lbl-info">
                            <label for="khoiluong-sanpham" class="form-label" value="0.00">Khối lượng <span
                                    style="color: red;">*</span></label>
                        </div>
                        <div class="input-group">
                            <input type="text" class="form-control" id="khoiluong-sanpham"
                                aria-describedby="khoiluong-sanpham2" required>
                            <span class="input-group-text" id="khoiluong-sanpham2">gram</span>
                        </div>
                    </div>

                    <div class="info col-md-6">
                        <div class="lbl-loai">
                            <label for="loai-sanpham" class="form-label">Loại sách</label>
                        </div>
                        <div class="loai-sanpham">
                            <select name="" id="loai-sanpham" class="form-control">
                                <option value="">Ngôn tình</option>
                                <option value="">Sách giáo khoa</option>
                                <option value="">Kinh tế</option>
                                <option value="">Truyện ngắn</option>
                                <option value="">Tiểu thuyết Việt Nam</option>
                            </select>
                            
                            <!-- Button trigger modal thêm sách -->
                            <div class="button-them">
                                <button class="btn btn-outline-success button-them-2" type="button"
                                    data-bs-toggle="modal" data-bs-target="#exampleModal">Thêm mới </button>
                            </div>
                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm loại sản phẩm </h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body row">
                                            <div class="md-12 row-them-loaiSP">
                                                <label for="ma-loai">Mã loại<span style="color: red;">*</span></label>
                                                <input type="text" class="form-control" id="ma-loai" placeholder="">
                                            </div>
                                            <div class="md-12  row-them-loaiSP">
                                                <label for="ten-loai">Tên loại <span
                                                        style="color: red;">*</span></label>
                                                <input type="text" class="form-control" id="ten-loai" placeholder="">
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-outline-dark"
                                                data-bs-dismiss="modal">Thoát</button>
                                            <button type="button" class="btn btn-success">Lưu</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info col-md-6">
                        <div class="lbl-info">
                            <label for="tacgia-sanpham" class="form-label">Tác giả <span
                                    style="color: red;">*</span></label>
                        </div>
                        <input type="text" class="form-control" id="tacgia-sanpham" />
                    </div>

                    <div class="info col-md-6">
                        <div class="lbl-info">
                            <label for="nhaxuatban-sanpham" class="form-label">Nhà xuất bản</label>
                        </div>
                        <input type="text" class="form-control" id="nhaxuatban-sanpham" />
                    </div>
                    <div class="info col-md-12 row">
                        <div class="message"></div>
                        <div class="col-md-6 container-file-upload">
                            <label for="file-upload" class="form-label custom-file-upload">
                                <i class="fa fa-cloud-upload "></i> Đăng tải ảnh sản phẩm
                            </label>
                        </div>
                        <div class="col-md-6 save-image">
                            <div id="input-save-image">
                                <input type="file" class="form-control" id="file-upload" multiple="multiple"
                                    accept="image/png, image/jpeg, imgae/jpg" />
                            </div>
                            <div class="show-img-form slider">
                                <div class="container-images slides">
                                    <div class="show-img-div">
                                    </div>
                                </div>
                                <!-- <button class="prev" onclick="prevClick()">&#10094</button>
                                <button class="next" onclick="nextClick()">&#10095</button> -->
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <div class="container-price-sanpham">
                <div class="title">
                    <h6>Giá sản phẩm</h6>
                </div>
                <div class="info col-md-12">
                    <div class="lbl-info">
                        <label for="price-sanpham" class="form-label">Mức giá của sản phẩm <span
                                style="color: red;">*</span></label>
                    </div>
                    <div class="input-group">
                        <input type="number" class="form-control" id="gia-sanpham" value="0.00" min="0" />
                        <span class="input-group-text" id="khoiluong-sanpham2">VNĐ</span>
                    </div>
                </div>
                <div class="info col-md-12">
                    <div class="lbl-info">
                        <label for="sale-sanpham" class="form-label">Sale sản phẩm</label>
                    </div>
                    <div class="input-group">
                        <input type="number" class="form-control" id="sale-sanpham" value="0" min="0" max="100" />
                        <span class="input-group-text" id="sale-sanpham2">%</span>
                    </div>
                </div>
                <div class="status form-check col-md-12">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" role="switch" id="allowed-sell" checked>
                        <label class="" for="allowed-sell">Cho phép bán</label>
                    </div>
                </div>
            </div>
            <div class="container-button">
                <button class="btn btn-outline-dark button-huy">Hủy</button>
                <a href=""> <button type="submit" class="btn btn-success button-themmoi">Thêm mới</a>
                </button>
            </div>
        </div>
    </main>

    <script>
        let imagesArray = [];
        //INPUT
        containerInputSaveImage = document.querySelector("#input-save-image");
        inputSaveImage = document.querySelector("#file-upload");
        //SHOW
        containerShowImg = document.querySelector(".show-img-form");
        showImg = document.querySelector(".show-img-div");
        //Message
        message = document.querySelector(".message");
        deleteImage = [];

        // Hàm kiểm tra xem ảnh đã tồn tại trong mảng hay chưa
        function isImageExists(image) {
            return imagesArray.some(existingImage => {
                return existingImage.name === image.name; //so sánh theo tên ảnh
            });
        }

        //THÊM IMG
        if (inputSaveImage) {
            inputSaveImage.addEventListener("change", () => {
                const files = inputSaveImage.files;
                for (let index = 0; index < files.length; index++) {
                    const image = files[index];
                    const maxSize = 5 * 1024 * 1024; // 5 MB (có thể điều chỉnh theo nhu cầu)
                    const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg'];
                    const newImageCount = event.target.files.length + showImg.childElementCount;


                    if (newImageCount > 3) {
                        message.innerHTML = "Bạn chỉ có thể tải lên tối đa 3 ảnh.";
                        message.style.cssText  = "background-color:#f8d7da; color :#b71c1c";
                        inputSaveImage.value = ''; // Reset file input
                        return;
                    }else if(event.target.files.length  <= 3){
                        message.innerHTML = "";
                        message.style.cssText  = "";
                    }

                    if (image.size > maxSize) {
                        message.innerHTML = "Kích thước file ảnh quá lớn, vui lòng chọn file khác.";
                        message.style.cssText  = "background-color: #f8d7da; color :#b71c1c";
                        return;
                    }
                    // Kiểm tra loại file
                    if (!allowedTypes.includes(image.type)) {
                        message.innerHTML('Loại file không hợp lệ, vui lòng chọn file ảnh có định dạng PNG, JPEG hoặc JPG.');
                        message.style.cssText = "background-color: #f8d7da; color :#b71c1c";
                        return;
                    }
                    // Kiểm tra xem ảnh đã tồn tại trong mảng hay chưa
                    if (!isImageExists(image)) {
                        imagesArray.push(image);
                    } else {
                        imagesArray[index] = image;
                    }
                }
                displayImage();
            })
        } else {
            console.log("Element with id 'show-img-form' not found.");
        }

        // DISPLAY IMAGE
        function displayImage() {
            showImg.innerHTML = ""; // Xóa bỏ tất cả các phần tử hiện có trước khi tạo mới
            imagesArray.forEach((imageFile, index) => {
                // Tạo các phần tử ảnh và nút xóa
                const table = document.createElement('table');
                const col = document.createElement('col');

                const img = document.createElement('img');
                img.src = URL.createObjectURL(imageFile);
                img.alt = 'image';

                const span = document.createElement('span');
                span.textContent = '×';
                span.style.cursor = 'pointer';
                span.onclick = function () {
                    imagesArray.splice(index, 1);
                    displayImage();
                };

                // Thêm các phần tử vào container
                const imageContainer = document.createElement('div');
                imageContainer.classList.add('image');
                imageContainer.appendChild(img);
                imageContainer.appendChild(span);

                
                imageContainer.appendChild(table);
                table.appendChild(col);

                // Thêm container vào showImg
                showImg.appendChild(imageContainer);
                // slideShow();
            });
        }

        containerShowImg.addEventListener("submit", (e) => {
            e.preventDefault();
            sendImageToServer();
        });

        //DROP IMAGE
        // try {
        //     containerInputSaveImage.addEventListener("drop", (e) => {
        //         e.preventDefault();
        //         const files = e.dataTransfer.files;
        //         for(let index = 0; index < files.length; index++){
        //             if(!files[index].type.match("image")) continue;
        //             if(imagesArray.every(image => image.name !== files[index].name)){
        //                 imagesArray.push(files[index]);
        //             }
        //             displayImage()
        //         }
        //         });
        //     } catch (error) {
        //     console.error("An error occurred:", error);
        // }

        //Send Image To Server
        // function sendImageToServer() {
        //     const formData = new FormData(); // Tạo FormData mới
        //     imagesArray.forEach((image, index) => {
        //         formData.append(`file[${index}]`, image); // Thêm từng ảnh vào FormData
        //     });
        //     fetch("upload", {
        //         method: "POST",
        //         body: formData
        //     })
        //         .then(response => {
        //             if (response.status !== 200) throw Error(response.statusText);
        //             location.reload(); // Tải lại trang sau khi tải lên thành công
        //         })
        //         .catch(error => {
        //             message.innerHTML = error;
        //             message.style.cssText = "background-color: #f8d7da; color :#b71c1c";
        //         });
        // }


        // SLIDE SHOW
    </script>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
</body>

</html>